# Модуль управления марками и моделями автомобилей

Модуль для хранения и управления информацией о марках и моделях автомобилей.

## Установка

1. Модуль уже находится в `modules/cars/`

2. Модуль уже добавлен в `config/web.php`:
```php
'cars' => [
    'class' => 'app\modules\cars\Cars',
],
```

3. Выполните миграции для создания таблиц и заполнения данных:
```bash
php yii migrate --migrationPath=@app/modules/cars/migrations
```

## Структура модуля

```
modules/cars/
├── Cars.php                              # Класс модуля
├── controllers/
│   ├── CarMarkController.php             # Контроллер марок
│   └── CarModelController.php            # Контроллер моделей
├── models/
│   ├── CarMark.php                       # Модель марки
│   ├── CarMarkSearch.php                 # Модель поиска марок
│   ├── CarModel.php                      # Модель модели
│   └── CarModelSearch.php                # Модель поиска моделей
├── migrations/
│   ├── m251222_210000_create_car_tables.php
│   └── m251222_220000_insert_cars_data_from_csv.php
└── views/
    ├── car-mark/                         # Представления марок
    └── car-model/                        # Представления моделей
```

## Структура базы данных

### Таблица `car_mark` (Марки)

- **id** - ID марки
- **name** - Название марки (латиница)
- **name_cyrillic** - Название марки (кириллица)
- **is_popular** - Популярная марка (0/1)
- **country** - Страна
- **year_from** - Год начала производства марки
- **year_to** - Год окончания производства марки
- **created_at** - Дата создания
- **updated_at** - Дата обновления

### Таблица `car_model` (Модели)

- **id** - ID модели
- **mark_id** - ID марки (внешний ключ)
- **name** - Название модели (латиница)
- **name_cyrillic** - Название модели (кириллица)
- **class** - Класс автомобиля
- **year_from** - Год начала производства модели
- **year_to** - Год окончания производства модели
- **created_at** - Дата создания
- **updated_at** - Дата обновления

## Использование

### Доступ к модулю

После установки модуль доступен по адресам:
- Марки: `/cars/car-mark/index`
- Модели: `/cars/car-model/index`

Или через меню: **Списки → Марки автомобилей / Модели автомобилей** (для администраторов)

### Основные функции

1. **Управление марками:**
   - Создание, редактирование, удаление марок
   - Просмотр списка с поиском и фильтрацией
   - Просмотр моделей марки

2. **Управление моделями:**
   - Создание, редактирование, удаление моделей
   - Привязка к маркам
   - Просмотр списка с поиском и фильтрацией

3. **Загрузка данных:**
   - Автоматическая загрузка из CSV файла `cars.csv`
   - Обработка ~4666 записей
   - Автоматическое создание уникальных марок

## API

### Получение списка марок

```php
use app\modules\cars\models\CarMark;

$marks = CarMark::find()
    ->orderBy(['name' => SORT_ASC])
    ->all();
```

### Получение моделей марки

```php
$mark = CarMark::findOne($markId);
$models = $mark->getModels()->all();
```

### Получение списка моделей

```php
use app\modules\cars\models\CarModel;

$models = CarModel::find()
    ->with('mark')
    ->orderBy(['name' => SORT_ASC])
    ->all();
```

## Особенности

- Автоматическое логирование дат создания и обновления
- Связь между марками и моделями через внешний ключ
- Каскадное удаление моделей при удалении марки
- Поиск по всем полям
- Индексы для быстрого поиска
- Загрузка данных из CSV файла с обработкой дубликатов

## Миграции

1. **m251222_210000_create_car_tables.php** - Создание таблиц
2. **m251222_220000_insert_cars_data_from_csv.php** - Заполнение данных из CSV

Миграция загрузки данных:
- Читает файл `cars.csv` из корня проекта
- Пропускает первый столбец (ID_MARK) и MODEL_ID
- Создает уникальные марки
- Создает все модели с привязкой к маркам
- Использует batch insert для производительности

